<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Veículos</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

    <h2>Cadastro de Veículos</h2>

    <form id="cadastroVeiculoForm">
        <label for="crlv">Upload CRLV (PDF):</label>
        <input type="file" id="crlv" name="crlv" accept=".pdf">
        <button type="button" onclick="uploadCRLV()">Enviar PDF</button>
        <p id="uploadMessage"></p>

        <label for="placa">Placa:</label>
        <input type="text" id="placa" name="placa" required>

        <label for="renavam">Renavam:</label>
        <input type="text" id="renavam" name="renavam" required>

        <label for="chassi">Chassi:</label>
        <input type="text" id="chassi" name="chassi" required>

        <label for="ano_fabricacao">Ano de Fabricação:</label>
        <input type="text" id="ano_fabricacao" name="ano_fabricacao" required>

        <label for="modelo">Modelo:</label>
        <input type="text" id="modelo" name="modelo" required>

        <label for="proprietario">Proprietário:</label>
        <input type="text" id="proprietario" name="proprietario" required>

        <button type="submit">Cadastrar</button>
    </form>

    <script>
        function uploadCRLV() {
            let fileInput = document.getElementById("crlv");
            let formData = new FormData();
            formData.append("file", fileInput.files[0]);

            fetch("/upload_crlv", {
                method: "POST",
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    document.getElementById("uploadMessage").innerText = "Erro: " + data.error;
                } else {
                    document.getElementById("uploadMessage").innerText = "Upload realizado com sucesso!";
                    
                    // Preenchendo os campos automaticamente
                    if (data.data) {
                        document.getElementById("placa").value = data.data.placa || "";
                        document.getElementById("renavam").value = data.data.renavam || "";
                        document.getElementById("chassi").value = data.data.chassi || "";
                        document.getElementById("ano_fabricacao").value = data.data.ano_fabricacao || "";
                        document.getElementById("modelo").value = data.data.modelo || "";
                        document.getElementById("proprietario").value = data.data.proprietario || "";
                    }
                }
            })
            .catch(error => {
                console.error("Erro ao enviar arquivo:", error);
                document.getElementById("uploadMessage").innerText = "Erro ao enviar arquivo.";
            });
        }
    </script>

</body>
</html>
